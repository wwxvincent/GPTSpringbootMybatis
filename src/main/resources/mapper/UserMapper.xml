<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.vincent.gptspringbootmd.mapper.UserMapper">

    <select id="getAllUsers" resultType="com.vincent.gptspringbootmd.entity.User">
        SELECT * FROM gptDB.user;
    </select>

    <select id="getUserById" parameterType="long" resultType="com.vincent.gptspringbootmd.entity.User">
        SELECT * FROM user WHERE id = #{id};
    </select>
    <!--multiple tables search  -->
    <select id="findAllUsersWithDepartment" resultType="java.util.Map">
        SELECT c.id AS departmentId, c.name AS departmentName, u.id AS userId, u.name AS userName, u.email AS userEmail
        FROM company c
        INNER JOIN user u ON c.id = u.depId
        WHERE c.id = #{departmentId}
    </select>

    <insert id="insertUser" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO user (id, name, email, depId)
        VALUES (#{id}, #{name}, #{email}, #{depId});
    </insert>
    <insert id="insertBatch">
        insert into user (id, name, email, depId)
        VALUES
        <foreach collection="users" item="user" separator=",">
            (#{user.id}, #{user.name},#{user.email}, #{user.depId} )
        </foreach>;
    </insert>

    <update id="updateUser">
<!--         UPDATE user SET name = #{name}, email = #{email} WHERE id = #{id}; -->
        UPDATE user
        <set>
            <if test="name != null and name !='' " >
                name = #{name},
            </if>
            <if test = "email != null and email !='' " >
                email = #{email},
            </if>
            <if test="depId !=null" >
                depId = #{depId}
            </if>
        </set>
        where id = #{id};
    </update>

    <delete id="deleteUser" parameterType="long">
        DELETE FROM user WHERE id = #{id};
    </delete>
</mapper>